<!doctype html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>ç”¨æˆ·ç®¡ç† - ç®¡ç†å‘˜åå°</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ</text></svg>">
    <!-- å¼•å…¥ Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.05); border-radius: 10px; }
        .btn-icon { padding: 4px 8px; font-size: 0.9rem; }
    </style>
</head>
<body>

<div class="container mt-5">
    <!-- é¡¶éƒ¨æ ‡é¢˜ -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3>ğŸ‘¥ ç”¨æˆ·æƒé™ç®¡ç†</h3>
        <a href="/dashboard" class="btn btn-outline-primary">è¿”å›ä»ªè¡¨ç›˜</a>
    </div>

    <!-- ç”¨æˆ·åˆ—è¡¨å¡ç‰‡ -->
    <div class="card">
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>ç”¨æˆ·å</th>
                            <th>è§’è‰²</th>
                            <th class="text-end">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for u in users %}
                        <tr>
                            <td>{{ u.id }}</td>
                            <td>
                                <span class="fw-bold text-dark">{{ u.username }}</span>
                                {% if u.username == username %}
                                    <span class="badge bg-success ms-1">æˆ‘</span>
                                {% endif %}
                            </td>
                            <td>
                                {% if u.role == 'admin' %}
                                    <span class="badge bg-primary">ç®¡ç†å‘˜</span>
                                {% else %}
                                    <span class="badge bg-secondary">æ™®é€šç”¨æˆ·</span>
                                {% endif %}
                            </td>
                            <td class="text-end">
                                <!-- ç¼–è¾‘æŒ‰é’® (è§¦å‘å¼¹çª—) -->
                                <button class="btn btn-sm btn-warning text-white me-1"
                                        onclick="openEditModal('{{ u.id }}', '{{ u.username }}', '{{ u.role }}')">
                                    âœï¸ ç¼–è¾‘
                                </button>

                                <!-- åˆ é™¤æŒ‰é’® -->
                                {% if u.username != username %}
                                    <a href="/admin/delete_user/{{ u.id }}"
                                       class="btn btn-sm btn-danger"
                                       onclick="return confirm('âš ï¸ ç¡®å®šè¦åˆ é™¤ç”¨æˆ· [{{ u.username }}] å—ï¼Ÿ\næ­¤æ“ä½œå°†åŒæ—¶åˆ é™¤è¯¥ç”¨æˆ·çš„æ‰€æœ‰èŠå¤©è®°å½•å’Œæ“ä½œæ—¥å¿—ï¼')">
                                        ğŸ—‘ï¸ åˆ é™¤
                                    </a>
                                {% else %}
                                    <button class="btn btn-sm btn-secondary" disabled>åˆ é™¤</button>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- ğŸ‘‡ğŸ‘‡ğŸ‘‡ ç¼–è¾‘ç”¨æˆ·å¼¹çª— (Modal) ğŸ‘‡ğŸ‘‡ğŸ‘‡ -->
<div class="modal fade" id="editUserModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">âœï¸ ç¼–è¾‘ç”¨æˆ·ä¿¡æ¯</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form action="/admin/edit_user" method="POST">
                <div class="modal-body">
                    <!-- éšè—å­—æ®µï¼šå­˜æ”¾ User ID -->
                    <input type="hidden" name="user_id" id="edit_user_id">

                    <!-- ç”¨æˆ·å -->
                    <div class="mb-3">
                        <label class="form-label">ç”¨æˆ·å</label>
                        <input type="text" class="form-control" name="username" id="edit_username" required>
                    </div>

                    <!-- è§’è‰²é€‰æ‹© -->
                    <div class="mb-3">
                        <label class="form-label">è§’è‰²æƒé™</label>
                        <select class="form-select" name="role" id="edit_role">
                            <option value="user">æ™®é€šç”¨æˆ·</option>
                            <option value="admin">ç®¡ç†å‘˜</option>
                        </select>
                    </div>

                    <!-- å¯†ç  -->
                    <div class="mb-3">
                        <label class="form-label">é‡ç½®å¯†ç </label>
                        <input type="text" class="form-control" name="password" placeholder="ä¸ä¿®æ”¹è¯·ç•™ç©º">
                        <div class="form-text text-muted">å¦‚æœä¸éœ€è¦ä¿®æ”¹å¯†ç ï¼Œè¯·ä¿æŒæ­¤æ ä¸ºç©ºã€‚</div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">å–æ¶ˆ</button>
                    <button type="submit" class="btn btn-primary">ä¿å­˜ä¿®æ”¹</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- å¼•å…¥ Bootstrap JS (ç”¨äºå¼¹çª—) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // æ‰“å¼€å¼¹çª—å¹¶å¡«å……æ•°æ®çš„å‡½æ•°
    function openEditModal(id, username, role) {
        // 1. è·å–å¼¹çª—å…ƒç´ 
        var myModal = new bootstrap.Modal(document.getElementById('editUserModal'));

        // 2. å¡«å……æ•°æ®åˆ°è¾“å…¥æ¡†
        document.getElementById('edit_user_id').value = id;
        document.getElementById('edit_username').value = username;
        document.getElementById('edit_role').value = role;

        // 3. æ˜¾ç¤ºå¼¹çª—
        myModal.show();
    }
</script>

</body>
</html>